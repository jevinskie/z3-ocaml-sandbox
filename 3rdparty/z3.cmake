set(Z3_USE_LIB_GMP ON)
set(Z3_SINGLE_THREADED ON)
set(Z3_POLLING_TIMER OFF) # TODO: test
set(Z3_BUILD_LIBZ3_SHARED ${BUILD_SHARED_LIBS})
set(Z3_BUILD_EXECUTABLE OFF)
set(Z3_INCLUDE_GIT_HASH OFF)
set(Z3_INCLUDE_GIT_DESCRIBE OFF)
add_subdirectory(z3)
# target_include_directories(libz3 PUBLIC "${CMAKE_CURRENT_BINARY_DIR}/z3/src/api")
set_target_properties(libz3 PROPERTIES EXCLUDE_FROM_ALL ON)

target_link_libraries(libz3 PRIVATE GMP)
get_target_property(libz3_sources libz3 SOURCES)
foreach(obj_target IN LISTS libz3_sources)
    if("${obj_target}" MATCHES "^\\$<TARGET_OBJECTS:(.*)>$")
        set(target_name "${CMAKE_MATCH_1}")
        target_link_libraries(${target_name} PUBLIC GMP)
    endif()
endforeach()
